<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Archives: 2013/10 | MZhou&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="MZhou's blog">
<meta property="og:url" content="http://nodejs.in/archives/2013/10/">
<meta property="og:site_name" content="MZhou's blog">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MZhou's blog">
<meta name="twitter:description">

  
    <link rel="alternative" href="/atom.xml" title="MZhou&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">

  
</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">MZhou&#39;s blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">专注于Web前端开发！</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="submit" value="&#xF002;" class="search-form-submit"><input type="hidden" name="q" value="site:http://nodejs.in"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-setmonthe696b9e6b395e58bbfe794a8e5afbce887b4e79a84e69c89e8b6a3bug" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2013/10/31/setmonthe696b9e6b395e58bbfe794a8e5afbce887b4e79a84e69c89e8b6a3bug/" class="article-date">
  <time datetime="2013-10-31T09:10:06.000Z" itemprop="datePublished">Oct 31 2013</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/javascript/">javascript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/10/31/setmonthe696b9e6b395e58bbfe794a8e5afbce887b4e79a84e69c89e8b6a3bug/">setMonth方法勿用导致地有趣bug</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>这不是什么新鲜的知识了，网上已有很多类似的文章说过这个点。这里纯粹记录下自己踩过地坑。言归正传，Javascript的Date实例有个方法setMonth，用于设置Date实例的月份和日期。如下：</p>
<p><pre>new Date().setMonth(8, 1);</pre><br>第一个参数为月份，整数区间为[0, 11]。第二个参数为日期，整数区间为[1, 31]。方法很简单，但是这个方法有个容易忽略的点。先看如下代码</p>
<p><pre>var strToDateStr = function (str) {<br>     var r = str.match(/(\d{4})-(\d{2})-(\d{2})/);<br>     var d = new Date();<br>     d.setFullYear(r[1]);<br>     d.setMonth(r[2] - 1);<br>     d.setDate(r[3]);<br>     return d;<br> }</pre><br>这个方法，用于将字符串转换成Date实例。不过它有一个bug，当你在2013年10月31号那天调用这个方法且输入为<code>2013-09-02</code>时，得到的输出是2013年10月02号。让我们来一行行分析下：</p>
<p><pre>     var d = new Date();<br>     // d 为10月31号<br>     d.setFullYear(‘2013’);<br>     // d 依旧为10月31号<br>     d.setMonth(8);<br>     // 9月没有31号，故d为10月1号<br>     d.setDate(‘02’);<br>     // d为10月2号</pre><br>这本不是<code>setMonth</code>的bug，反而是它的feature。只是因为对方法内部原理不了解导致了奇怪的bug。其实这里应该这么写：</p>
<p><pre>var strToDate = function (str) {<br>    var r = str.match(/(\d{4})-(\d{2})-(\d{2})/);<br>    return new Date(r[1], r[2] - 1, r[3], 0, 0, 0, 0);<br>};</pre><br>直接在初始化实例的时候确定月份和日期，速度应该会更快些。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://nodejs.in/2013/10/31/setmonthe696b9e6b395e58bbfe794a8e5afbce887b4e79a84e69c89e8b6a3bug/" data-id="6zr7cyt6xqv6cxh9" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bug/">bug</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/setMonth/">setMonth</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-e8af91html5-canvase680a7e883bde4b98be794bbe59c88" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2013/10/29/e8af91html5-canvase680a7e883bde4b98be794bbe59c88/" class="article-date">
  <time datetime="2013-10-29T15:23:16.000Z" itemprop="datePublished">Oct 29 2013</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/javascript/">javascript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/10/29/e8af91html5-canvase680a7e883bde4b98be794bbe59c88/">[译]HTML5 canvas性能之画圈</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>翻译自：<a href="http://my.opera.com/ODIN/blog/2012/12/13/html5-canvas-performance-drawing-circles" target="_blank" rel="external">http://my.opera.com/ODIN/blog/2012/12/13/html5-canvas-performance-drawing-circles</a>主要讲了HTML5 canvas性能方面的尝试，场景是在canvas上面绘制圆圈。</p>
<hr>
<p><img src="http://files.myopera.com/tagawa/blog/canvas-christmas-tree.jpg" alt="圣诞"></p>
<p>临近圣诞，我一直在尝试使用HTML5 canvas在圣诞树图片上面绘制泡泡。由于不知道哪种绘制的方法最好，最终在<a href="http://stackoverflow.com/questions/9742830/html5-canvas-glass-circle#answer-9743575" target="_blank" rel="external">Stack Overflow</a>上找到了使用radial gradients（辐射渐变）绘制圆圈的答案。</p>
<h2 id="圆圈">圆圈</h2>
<p>你可能已经知道，标准地画圆圈的方法是使用<code>arc()</code>：</p>
<pre><code><span class="comment">// Drawing a circle the traditional way</span>
ctx.beginPath();
ctx.arc(x, y, radius, <span class="number">0</span>, Math.PI * <span class="number">2</span>, <span class="literal">true</span>);
ctx.fillStyle = <span class="string">'rgba(195, 56, 56, 1)'</span>;
ctx.fill();
ctx.closePath();`&lt;/pre&gt;
以我之见，与SVG的例子相比这种绘制圆圈的方法有点笨重。我认为仅仅使用radial gradients是一种更明智的选择，只是不知道它的性能如何。
&lt;pre&gt;`<span class="comment">// Drawing a circle with a radial gradient</span>
<span class="keyword">var</span> gradient = ctx.createRadialGradient(x, y, <span class="number">0</span>, x, y, radius);
gradient.addColorStop(<span class="number">0.95</span>, <span class="string">'rgba(195, 56, 56, 1)'</span>);
gradient.addColorStop(<span class="number">1</span>, <span class="string">'rgba(195, 56, 56, 0)'</span>);
ctx.fillStyle = gradient;
ctx.fillRect(x - radius, y - radius, x + radius, y + radius);`&lt;/pre&gt;
毫无疑问地，使用radial gradients会比`arc()`更慢。慢了好几倍！你可以在[测试页面](http:<span class="comment">//people.opera.com/danield/html5/canvas-speed/)尝试下，就可以了解到速度的差距。</span>

如果我正确地思考，我应该意识到这点而不需要去测试它，这样可以节省些时间。但是我接下来尝试使用了球体（当然不是<span class="number">3</span>D地球体，是有色差渐变地圆圈）。

<span class="preprocessor">## 球体</span>

在canvas中有两种通用地方法来绘制球体：
</code></pre><ol>
<li>Radial grandients<pre>` // Drawing a sphere with radial gradients
 var gradient = ctx.createRadialGradient(x, y, 0, x, y, radius);
 gradient.addColorStop(0, 'rgba(255, 255, 255, 1)');
 gradient.addColorStop(0.2, 'rgba(255, 85, 85, 1)');
 gradient.addColorStop(0.95, 'rgba(128, 0, 0, 1)');
 gradient.addColorStop(1, 'rgba(128, 0, 0, 0)');
 ctx.fillStyle = gradient;
 ctx.fillRect(x - radius, y - radius, x + radius, y + radius);`</pre></li>
<li><p>使用drawImage()绘制边缘颜色与背景色相同（或透明、可以和背景融合）的图片<br><pre><code>// Drawing a sphere with an existing image
 var img = new Image();
 img.src = &#39;images/baubles.png&#39;;
 ctx.drawImage(img, x, y, width, height);</code></pre><br>和之前地例子一样，radial gradients要慢好几倍。当然优势就是radial gradients是可以即时地动态改变，而画图片地方法则需要预先制作好图片。那些图片没办法通过javascript来直接修改，虽然你可以很容易地修改它们显示大小。你也可以通过以下几种方法来控制颜色：</p>
</li>
<li><p>使用包含指定颜色图片地图片sprite</p>
</li>
<li><p>使用灰度图片，并且使用<code>arc()</code>来设置半透明浮层<br>别忘了，使用图片意味着它们需要被下载，所以记得如果可能预加载图片。</p>
<p>你可以在<a href="http://people.opera.com/danield/html5/canvas-speed/" target="_blank" rel="external">测试页面</a>上测试下性能。</p>
<p>你可以看到，很明显浮层方法较慢，但是和gradients相比还是快地。在控制颜色方面，它也给了你更多自由，不过所有地方法都要比单纯绘制原始图片要慢。</p>
<h2 id="总结">总结</h2>
<p>通常情况下，对于简单地地程序或者是快速地硬件来说，这些速度地差别是很难注意到地。但是如果你在使用动画、制作高性能游戏或是为TV/机顶盒之类地硬件设计程序，那么它们就会成为一个问题了。一如既往，所有的决定都是一种妥协，所以这里列出了各种权衡情况的总结：</p>
</li>
</ol>
<ul>
<li>如果你想要绘制圆圈，使用<code>arc()</code></li>
<li>如果你想要绘制球体，使用一张图片（预加载它）</li>
<li>如果你绘制各种各样的图片，使用图片sprites</li>
<li>如果你想要球体可以动态改变颜色，考虑使用一张图片和半透明浮层</li>
<li><p>只有在万不得已的情况下才使用radial gradients</p>
<h2 id="更新：">更新：</h2>
<p><a href="https://twitter.com/askoth" target="_blank" rel="external">Marcelo</a>提出了一种很酷的方法：在一个隐藏的canvas上面创建一个简单的图片，然后使用<code>drawImage()</code>重复绘制它。这种方法避免了创建图片的步骤，并且也可以即时修改颜色。最棒的是，不考虑初始化gradient的时间，它比绘制一张已有的图片还要快！代码如下：<br><pre>`// Create a second “buffer” canvas but don’t append it to the document<br>var tmpCanvas = document.createElement(‘canvas’);<br>var tmpCtx = tmpCanvas.getContext(‘2d’);</pre></p>
<p>// Add the necessary gradients here, as above</p>
<p>// Draw the image from the second “buffer” canvas<br>ctx.drawImage(tmpCanvas, x, y, width, height);</p>
</li>
</ul>
<p>所以，如果你正在绘制很多的圆圈或是球体，我推荐使用这种方法。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://nodejs.in/2013/10/29/e8af91html5-canvase680a7e883bde4b98be794bbe59c88/" data-id="vgz79prbf46ztmu0" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/canvas/">canvas</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-e8af91javascript-test-spies-stubs-and-mocks" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2013/10/29/e8af91javascript-test-spies-stubs-and-mocks/" class="article-date">
  <time datetime="2013-10-29T15:16:53.000Z" itemprop="datePublished">Oct 29 2013</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/javascript/">javascript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/10/29/e8af91javascript-test-spies-stubs-and-mocks/">[译]Javascript Test Spies, Stubs and Mocks</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>译者言：本文是<cite>Test-Driven Javascript Development</cite>一书的作者的博文，关于他设计Javascript测试库<a href="http://sinonjs.org/" target="_blank" rel="external">Sinon</a>时的思路和想法。</p>
<hr>
<p>最近我在写<a href="http://cjohansen.no/en/javascript/test_driven_javascript_the_book" target="_blank" rel="external">书</a>过程中遇到的事情就是一个叫Sinon的Javascript stubbing和mocking库（还在开发中）。一次给出三篇文章来展示API的预览。希望可以得到一些你们的想法和反馈。</p>
<p>在这篇文章中，我们会了解库里面的核心部分：spies，stubs和mocks。我会覆盖到此库的基本想法，并且展示最为相关的API。</p>
<h2 id="Sinon的目标">Sinon的目标</h2>
<p>为什么要写另一个stubbing和mocking的库呢？现在已经有了不少类似的库了，并且有部分测试库发布时就内建了stub和mocks的功能。原本我写Sinon是为了写书，在“TDD by example”这一章节里面使用它。最终这没有成为现实，但是我依旧使用它作为“使用stubbing和mocking库”的样例（相对于我们最简单、最经常遇到的手工stubbing的情况）。</p>
<p>我对这样的一个库做了如下需求设计：</p>
<ul>
<li><strong>独立</strong> 没有理由把stubbing和mocking功能绑定到一个指定的测试库中。虽然在某些情况下它可以被自动化，但是这样的集成也可以由独立的库来提供。</li>
<li><strong>最小化全局变量占用</strong> 在测试环境中你绝对不希望大量的全局命名污染。Stub和Mock API<br>必须是在同一个对象上的</li>
<li><strong>容易使用</strong> 这可能是理所应当的，但是某些我见过的mocking解决方案就需要大量额外的工具库依赖才可以运行。</li>
<li><strong>容易集成</strong> 之所以做成独立的库，就是希望最小化库，使其容易被自动集成到任何测试库中。</li>
<li><strong>CommonJS兼容</strong> 使用CommonJS模块标准，能同时工作在浏览器和Server上<br>Sinon实现了这些需求。它是独立的，它的API都在<code>sinon</code>对象上，它拥有一个（希望是）简单的API并且提供了一系列工具来减少依赖大量的工具库。这篇文章专注于它的API，并且我会很快发布关于集成部分的文章。</li>
</ul>
<h2 id="现状">现状</h2>
<p>目前，Sinon的核心（本篇文章覆盖到的）是可以工作的，但是库整体还没有完成，API本身也没有固定。我希望通过分享这些信息来降低提供反馈和建议的门槛。我不会正式发布它，知道我有了合适的文档。这篇文章以及之后的两篇是一个开始。</p>
<p>结束聊天，直接上代码</p>
<h2 id="Test_spies">Test spies</h2>
<p><a href="http://xunitpatterns.com/Test%20Spy.html" target="_blank" rel="external">测试spy</a>是一个对象，它记录了自己与整个代码库中其他对象交互。当无法仅仅通过可用对象状态来决定一个测试成功与否的时候，我们可以使用测试spies，并且断言回调的执行次数、传递的参数、返回值等等。</p>
<p>Sinon以函数的形式实现了spies，它包裹了其他函数，然后记录每次调用，包括<code>this</code>、参数、返回值和任何抛出的exception。它可以在不影响默认行为的情况监控方法，虽然在实践中你很少会直接创建spy。Stubs和mocks都是通过spy借口实现的。</p>
<p>Spies有一些属性和有用的方法。如下是你监控jQuery的<code>ajax</code>方法的例子：</p>
<pre><code>sinon.spy(jQuery, <span class="string">"ajax"</span>);
jQuery.getJSON(<span class="string">"/some/data"</span>);`<span class="variable">&lt;/pre&gt;</span>
这么做不会影响`jQuery.ajax`的默认行为，但是它会包裹这个方法并记录数据。

<span class="comment">### 属性</span>

如下的属性是spies暴露的，并且是如上样例对应的结果：
</code></pre><ul>
<li><code>jQuery.ajax.called</code> boolean, <code>true</code></li>
<li><code>jQuery.ajax.callCount</code> number, <code>1</code></li>
<li><code>jQuery.ajax.calledOnce</code> boolean, <code>true</code></li>
<li><code>jQuery.ajax.calledTwice</code> boolean, <code>false</code></li>
<li><p><code>jQuery.ajax.calledThrice</code> boolean, <code>false</code></p>
<h3 id="调用数据">调用数据</h3>
<p>Spies在四个数组中存储了调用数据。如果你喜欢底层代码，你们你会需要他们。</p>
</li>
<li><p><code>jQuery.ajax.args</code>是spy接收到的arguments数组。为了获取到第一次调用的第一个参数，你需要这么做<code>jQuery.ajax.args[0][0]</code>，第一个0表示调用次数，第二个表示第几个参数。</p>
</li>
<li><code>jQuery.ajax.returnValues</code>是回调函数的返回结果数组。为了获得第一次调用的返回结果，你需要这么做<code>jQuery.ajax.returnValues[0]</code>。对那些没有显示返回值的调用，数组会存储<code>undefined</code>值。</li>
<li><code>jQuery.ajax.exceptions</code>是spy抛出的exception的数组。如果spy在给定的调用中不抛出exception，数组会存储<code>undefined</code>。这个数组每次调用总是包含一个实体，不管它有没有抛出它。</li>
<li><p><code>jQuery.ajax.thisValues</code>是包含了<code>this</code>值的数组。对每次调用，spy存储<code>this</code>值到数组中，它在测试绑定了特殊对象的函数或是使用了<code>call</code>和<code>apply</code>方法的函数调用时很有用。</p>
<h3 id="方法">方法</h3>
<p>如果你喜欢底层代码，上面的四个数组可以提供你想要的所有东西，帮助你监控调用的整个过程。如果你和我更像一些，喜欢高层封装方法来让测试用例的意图更清晰，你可能更喜欢如下提供的方法。</p>
</li>
<li><p><code>jQuery.ajax.calledWith(arg1, arg2, ...)</code>此方法传递任意数量的参数，并且只要指定的arguments被调用了一次，那么这个方法就会返回<code>true</code>。arguments列表不需要很详细 - 你可以提供第一个参数，如果任意一次调用的参数中第一个是你传递的值，你们这个方法就会返回<code>true</code>。（这解决了可选参数的情况）</p>
</li>
<li><code>jQuery.ajax.calledWithExactly(arg1, arg2, ...)</code>如果你需要知道一个函数是否接收了指定的参数，并且只有那些指定的参数，这个方法就是<code>calledWith(arg1, arg2, ...)</code>的严格版本。</li>
<li><code>jQuery.ajax.alwaysCalledWith(arg1, arg2, ...)</code>和<code>calledWith(arg1, arg2, ...)</code>几乎一样，除了它需要所有的调用都符合。</li>
<li><code>jQuery.ajax.alwaysCalledWithExactly(arg1, arg2, ...)</code>和<code>calledWith(arg1, arg2, ...)</code>类似，只是它需要所有的调用都严格相符。</li>
<li><code>returned(returnValue)</code>返回<code>true</code>，如果spy返回的值与指定的值相同。</li>
<li><code>alwaysReturned(returnValue)</code>同上，只有在符合所有调用的时候返回<code>true</code>。</li>
<li><p><code>threw(exceptionOrType)</code>如果没有参数被传递且如果spy任意一次调用中抛出一个exception，那么方法返回<code>true</code>。如果一个字符串被传递给它，且spy抛出一个相同类型的excption（例如<code>TypeError</code>），那么方法返回<code>true</code>。最后，如果一个exception对象被传递给它，且spy抛出的exception对象和指定的对象一致（这个不太可能被用到，因为没办法构造完全一致的对象），那么方法返回<code>true</code>。</p>
<p>我认为这个方法可以接收两个字符串，分别表示抛出错误的类型和message。它甚至接收一个字符串的类型和正则表达式来匹配message。你怎么认为？</p>
</li>
<li><code>alwaysThrew(...)</code>同上，只是必须全部的调用都符合。</li>
<li><code>calledOn(thisObj)</code><br>如果方法被调用时的this值是指定的值，那么返回<code>true</code>。</li>
<li><p><code>alwaysCalledOn(...)</code><br>同上，只是必须全部的调用都符合。<br>作为补充，spies有一个特殊的方法来“解除”它们被监控的方法：<br><pre><code>jQuery.ajax.restore();</code></pre><br>这个方法解除了包裹并且恢复了默认的方法。为了spies在测试之间泄露，所有spies都可以在测试用例<code>tearDown</code>（举个例子）的时候恢复。</p>
<p>使用这些方法及断言可以实现可读性较好的测试：<br><pre>`”test should register click events for buttons”: function () {<br>  sinon.spy(dom, “addEventHandler”);<br>  var buttons = dom.get(“div.button”, this.form);</pre></p>
<p>  this.feedback.setForm(this.form);</p>
<p>  assert(dom.addEventHandler.calledWith(buttons[0], “click”));<br>  assert(dom.addEventHandler.calledWith(buttons[1], “click”));<br>  assert(dom.addEventHandler.calledWith(buttons[2], “click”));<br>}`<br>这个测试使用了一些库中自带的工具。它验证了一个表单中的所有按钮都绑定了点击事件的监听。注意断言只检查了两个参数——元素和事件名，没有包含回调函数。review这个例子让我意识到我可以在这个例子中使用事件代理，但是好吧……</p>
<p>Sinon有一些更高层的工具来使用spies，我会在下一篇文章中覆盖到它们。</p>
<h2 id="Stubs">Stubs</h2>
<p><a href="http://xunitpatterns.com/Test%20Stub.html" target="_blank" rel="external">测试Stubs</a>是假的对象，它们被预先编码了行为。它们会在下面两个情况下被用到：</p>
</li>
</ul>
<ol>
<li>避免使用不方便的借口——例如避免向服务器请求数据</li>
<li><p>反馈给系统已知的数据，强制指定代码路径<br>Javascript函数是“first-class”（译者言：词法作用域的概念，有人翻译成一等公民，窃以为不合适故不翻译）的，这让你花很长时间决定伪代码样例：<br><pre>`”test should call event handler”: function () {<br>  var handler = function () { handler.called = true; };<br>  var myElement = document.getElementsByTagName(“a”)[0];</pre></p>
<p>  dom.addEventListener(myElement, “mouseover”, handler);<br>  dom.fireEvent(myElement, “mouseover”);</p>
<p>  assertTrue(handler.called);<br>}<code>&lt;/pre&gt;
因为Javascript函数如此的多才多艺，大部分情况下对stubs的使用是很容易解决的。然而，在做了一段时间之后，你意识到使用一个库可以减少你的工作量，特别是stub全局接口的时候，例如之前说的</code>jQuery.ajax`。</p>
<h3 id="创建Stub">创建Stub</h3>
<p>Sinon提供了一个简单的创建stub的API。调用<code>sinon.stub()</code>就可以创建stub。它返回了一个“空”函数，这个函数支持之前提到过的spy的API。这样上面的那个例子可以被写成：<br><pre>`”test should call event handler”: function () {<br>  var handler = sinon.stub();<br>  var myElement = document.getElementsByTagName(“a”)[0];</pre></p>
<p>  dom.addEventListener(myElement, “mouseover”, handler);<br>  dom.fireEvent(myElement, “mouseover”);</p>
<p>  assertTrue(handler.called);<br>}`<br>代码只是变得简单了一点点，不过这是个非常简单的例子。因为它支持所有的spy的接口，我们可以检查调用次数、this、arguments以及其他。</p>
<h3 id="Stubs的方法">Stubs的方法</h3>
</li>
</ol>
<ul>
<li><code>returns(returnValue)</code>设置stub的返回值。</li>
<li><code>throws(exception)</code>设置stub抛出的exception，如果参数是一个字符串，则代表了抛出exception的类型。如果它是一个对象，则会把他当作一个exception抛出。如果没有提供参数，那么会在调用时抛出一个<code>Error</code>。</li>
<li><code>callsArg(index)</code><strong>此API很可能会改变！</strong> 这个方法会导致stub立即调用并将参数传递进去。index参数表示传入参数的序号（从0开始），对应序号的参数会被当作一个回调函数。我认为这个方法的名字或者参数都不太好。欢迎给出建议。</li>
<li><p><code>callsArgWith(index, arg1, arg2, ...)</code><strong>此API很可能会改变！</strong> 就像上面的方法一样，只是你可以为回调函数设置参数。和<code>callsArg</code>一样，我不确信这个方法的命名是否够好。我希望它更加直观，但是这是我能想到最好的了。<br>对于最后两个方法只要我把它们设计的够好，它们一定会非常有用。我也想让stub可以在调用时传递“可选”的参数。我还没有想到一个合理长度的、清晰简明的命名。目前它还有明显的不足，欢迎给我提意见。</p>
<p>所有的方法都返回stub，所以它们可以链式调用，例如：<br><pre><code>sinon.stub(jQuery, &quot;each&quot;).callsArgWith(1, {}).returns({});</code></pre><br>上面代码创建了<code>jQuery.each</code>方法的stub。当它被调用的时候，会以<code>callsArgWith</code>方法的第二参数作为参数，并且返回一个空对象。</p>
<p>stub的真实力量是可以拥有spy的接口。记住被stub的接口集成了例如<code>restore</code>之类的方法，故可以恢复成为原本的方法。</p>
<h2 id="Mocks">Mocks</h2>
<p><a href="http://xunitpatterns.com/Mock%20Object.html" target="_blank" rel="external">Mock对象</a>就像是stubs和spies的组合，并且内建了<em>预编码地验证行为</em>，也被成为<em>期望</em>。Mocks会在前期设置它们的期望（而不会像我们常见的断言一样在执行后判断是否符合期望）并且在接收到不被期望的调用时立即失败。最终<code>mock.verify()</code>的调用会验证所有的期望是否符合。</p>
<h3 id="创建mocks">创建mocks</h3>
<p>你可以创建一个匿名函数的mock，例如：<br><pre>`”test should call event handler”: function () {<br>  var mock = sinon.mock();<br>  var myElement = document.getElementsByTagName(“a”)[0];</pre></p>
<p>  dom.addEventListener(myElement, “mouseover”, mock);<br>  dom.fireEvent(myElement, “mouseover”);</p>
<p>  mock.verify();<br>}<code>&lt;/pre&gt;
如果mock被调用了超过一次，这个测试会立马失败。当</code>verify()`被调用时，如果mock没有被调用过则会抛出一个exception。</p>
<p>你也可以为一个对象上的方法创建mock，这就和spies和stubs一样。接口稍微有些不同，我们需要创建：一个mock对象和设置我们想要给于期望的方法。<br><pre><code>var mock = sinon.mock(jQuery);
mock.expects(&quot;each&quot;).once().callsArgWith(1, {}).returns({});</code></pre><br>如上代码创建了<code>jQuery.each</code>方法的期望：只被调用一次，并且指示它向之前的stub一样运作。</p>
<h3 id="控制mock的期望">控制mock的期望</h3>
<p>Sinon的mocks支持了spy和stub的接口，尽管spy的接口比起mocks的接口来说没那么有趣。通常前期你会使用如下的方法来设置期望。注意这些方法也会返回expectation，这样你可以使用链式调用，符合声明使得代码可读性更高。</p>
</li>
<li><p><code>execptation.atLeast(callCount)</code>确保mock的被调用次数达到指定的次数。</p>
</li>
<li><code>expectation.atMost(callCount)</code>确保mock的被调用次数不会超过指定的次数。</li>
<li><code>expectation.exactly(callCount)</code>指定mock被调用的次数。</li>
<li><code>expectation.never()``exactly(0)</code>的快捷方法。</li>
<li><code>expectation.once()``exactly(1)</code>的快捷方法。</li>
<li><code>expectation.twice()``exactly(2)</code>的快捷方法。</li>
<li><code>expectation.thrice()``exactly(3)</code>的快捷方法。</li>
<li><code>expectation.withArgs(arg1, arg2, ...)</code>就像spy的<code>calledWith(arg1, arg2, ...)</code>方法一样，只不过是它是用作前期对期望的设置。</li>
<li><code>expectation.withExactArgs(arg1, arg2, ...)</code>就像spy的<code>calledWithExactly(arg1, arg2, ...)</code>方法一样，只不过是它是用作前期对期望的设置。</li>
<li><p><code>expectation.on(thisObj)</code>期望<code>this</code>值匹配指定的对象。<br>另外，mocks也继承了<code>restore</code>方法来恢复原始的方法。然而，大多数情况下你不需要直接调用它，<code>verify</code>方法会在验证所有的期望之后恢复方法。</p>
<p>下面是我在书中用到的一个例子。我构建了一个<a href="http://en.wikipedia.org/wiki/Comet_%28programming%29" target="_blank" rel="external">comet客户端</a>用于长轮询从服务器端返回数据。下面的例子中期望在comet客户端在执行<code>connect</code>方法的时候，调用<code>ajax.poll</code>方法并传给指定的url。<br><pre>`”test connect should start polling”: function () {<br>  var client = Object.create(ajax.cometClient);<br>  client.url = “/my/url”;<br>  var mock = sinon.mock(ajax);<br>  mock.expects(“poll”).once().withArgs(“/my/url”).returns({});</pre></p>
<p>  client.connect();</p>
<p>  mock.verify();<br>}</p>
</li>
</ul>
<p>你可能已经注意到<code>mock.verify</code>每次都在最后被调用，可以在测试框架中集成在最后默认执行会是一种不错的方式。我会展示在下一篇文章中展示Sinon在这个领域提供的东西。</p>
<h2 id="现状-1">现状</h2>
<p>目前，这篇文章中提到的东西都是可以工作的，经过了充份的测试并且可以使用。如果你想要尝试，你可以找到一份<a href="http://cjohansen.no/sinon/sinon.preview-20100525.js" target="_blank" rel="external">preview version</a>。所有的代码在<a href="http://gitorious.org/sinon/" target="_blank" rel="external">Gitorious</a>都可以找到。文档还很欠缺。还有更多特性可以被使用，它们会在下几篇文章中描述。最后，我正在写test/stub/mock timer和XMLHttpRequest的工具，但是它们还没有被完成。（译者言：翻译此文的时候这些都已经完成了，可以去<a href="http://sinonjs.org/" target="_blank" rel="external">Sinon.JS</a>官网看下）</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://nodejs.in/2013/10/29/e8af91javascript-test-spies-stubs-and-mocks/" data-id="fvoc16o6hl1hs0w5" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Sinon/">Sinon</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mocks/">mocks</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/spies/">spies</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/stubs/">stubs</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tdd/">tdd</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/test/">test</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/测试框架/">测试框架</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-watch-jse6ba90e7a081e8a7a3e8afbb" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2013/10/29/watch-jse6ba90e7a081e8a7a3e8afbb/" class="article-date">
  <time datetime="2013-10-29T15:10:57.000Z" itemprop="datePublished">Oct 29 2013</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/javascript/">javascript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/10/29/watch-jse6ba90e7a081e8a7a3e8afbb/">watch.js源码解读</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>用麻雀虽小五脏俱全来描述<a href="https://github.com/melanke/Watch.JS" target="_blank" rel="external">Watch.js</a>比较合适。“观察者”模式是我们在开发的时候经常需要用到的。使用Watch.js那么我们就可以实现在<em>“每当对象属性改变的时候，执行你的函数”</em>。虽然有很多其他的库可以实现相同的功能，但是Watch.js却可以不改变你平时书写代码的方式，并且实现属性改变的监听功能。
        
          <p class="article-more-link">
            <a href="/2013/10/29/watch-jse6ba90e7a081e8a7a3e8afbb/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://nodejs.in/2013/10/29/watch-jse6ba90e7a081e8a7a3e8afbb/" data-id="fzinoo7pvhxpcxvq" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ObjectdefineProperty/">Object.defineProperty</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/watchjs/">watch.js</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/观察者模式/">观察者模式</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ecmascript-6e4b98bweakmap" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2013/10/29/ecmascript-6e4b98bweakmap/" class="article-date">
  <time datetime="2013-10-29T14:57:40.000Z" itemprop="datePublished">Oct 29 2013</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/javascript/">javascript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/10/29/ecmascript-6e4b98bweakmap/">ECMAScript 6之WeakMap</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>ECMAScript 6中加入了很多新的特性，其中有一个有用的API：WeakMap。<a href="http://www.nczonline.net/blog/2012/11/06/ecmascript-6-collections-part-3-weakmaps/" target="_blank" rel="external">Nicholas的博文</a>做了详细的介绍。这也是一篇关于WeakMap的笔记。</p>
<hr>
<h2 id="简介">简介</h2>
<p><code>WeakMap</code>与<code>Map</code>（另一个ES6的新API）都是键值对象，有着类似的API：<code>set</code>、<code>get</code>、<code>has</code>和<code>delete</code>。为了更好的解释<code>WeakMap</code>，先谈下Javascript中的键值对象。JS中几乎所有可写的对象就可以当作一个键值对象，例如：</p>
<pre><code><span class="reserved">var</span> map = {};
map[<span class="string">'key'</span>] = <span class="string">'value'</span>;`<span class="javascript">&lt;<span class="regexp">/pre&gt;
但是这样简单的键值对象达不到一个效果：它的键“不能”是对象。之所以打引号是因为并不是不能用对象，而是对象会转换成字符串，如下：
&lt;pre&gt;</span></span>`<span class="reserved">var</span> map = {};
<span class="reserved">var</span> key = {};
map[key] = <span class="string">'value'</span>;
map[<span class="string">'[object Object]'</span>] === <span class="string">'value'</span>; <span class="regexp">//</span> <span class="literal">true</span>`<span class="javascript">&lt;<span class="regexp">/pre&gt;
于是ES6就提供了</span></span>`Map`<span class="javascript">与</span>`WeakMap`<span class="javascript">的API，可以实现键是对象的情况。但是这引来了另外一个问题，</span>`Map`<span class="javascript">是可以通过</span>`keys`<span class="javascript">方法来获取其所有的键。这就需要map保留一个对键的强引用，于是就导致了引用释放上的不方便，稍微大意一些就容易造成内存泄漏。

于是又提供了</span>`WeakMap`<span class="javascript">，它的键只能是一个非空（<span class="literal">null</span>）对象，而</span>`Map`<span class="javascript">的键则还可以是除对象外的原始类型。</span>`WeakMap`<span class="javascript">的重要特点在于：对键的引用是弱引用，而不是一般的强引用。看如下例子：
&lt;pre&gt;</span>`<span class="reserved">var</span> map = <span class="keyword">new</span> WeakMap(),
element = <span class="built_in">document</span>.querySelector(<span class="string">".element"</span>);

<span class="regexp">//</span> 对象element作为键，<span class="string">"Original"</span>作为值
map.set(element, <span class="string">"Original"</span>);

<span class="regexp">//</span> 可以通过element获得值
<span class="reserved">var</span> value = map.get(element);
<span class="built_in">console</span>.log(value);             <span class="regexp">//</span> <span class="string">"Original"</span>

<span class="regexp">//</span> 下面删除对element的强引用
element.parentNode.removeChild(element);
element = <span class="literal">null</span>;

<span class="regexp">//</span> element dom对象被释放
<span class="regexp">//</span> 已经无法通过element获取“Original”值`<span class="javascript">&lt;<span class="regexp">/pre&gt;
</span></span>`WeakMap`<span class="javascript">的键只能是非空（<span class="literal">null</span>）对象，所以如果你在</span>`get`<span class="javascript">方法里面传入<span class="literal">null</span>或是<span class="literal">undefined</span>之类的值，就会报错：“value is not a non-<span class="literal">null</span> object”。它的另外一个特点就是无法获取所有的键，更无法获取size之类的值。

</span>`WeakMap`<span class="javascript">一个典型的应用场景就是对于jQuery这样的库，需要维护一个dom列表，存储对应每个dom的数据。这时候使用它就可以达到“dom在文档中被移除的时候，自动释放dom对象”。

当然ES6目前还没有普及，支持的浏览器仅有Firefox和Chrome。在chrome中你需要到</span>`<span class="attribute">chrome</span>:<span class="regexp">//</span>flags`<span class="javascript">，并且启用“Experimental JavaScript Features”。所以我们需要fallback。

## Fallback

Gozala提供了一个很精妙的[fallback方案](https:<span class="comment">//gist.github.com/1269991)！接下来对它的代码做解读。要实现WeakMap有几个关注点：</span></span>
</code></pre><ol>
<li>键一定是非空对象</li>
<li>键无法被获取到</li>
<li><p>WeakMap不能保留对键的强引用<br>因为这个方案是基于ECMAScript 5的，所以使用了<code>Object.freeze</code>和<code>Object.create</code>之类的API。WeakMap的初始化函数如下：<br><pre><code>function WeakMap() {
  /**
  Implementation of harmony</code>WeakMaps<code>, in ES5\. This implementation will
  work only with keys that have configurable</code>valueOf` property (which is<br>  a default for all non-frozen objects).<br>  <a href="http://wiki.ecmascript.org/doku.php?id=harmony:weak_maps" target="_blank" rel="external">http://wiki.ecmascript.org/doku.php?id=harmony:weak_maps</a><br>  **/</pre></p>
<p>  var privates = Name()<br>  return Object.freeze(Object.create(WeakMap.prototype, {</p>
<pre><code>has: {
  <span class="built_in">value</span>: <span class="function"><span class="keyword">function</span> <span class="title">has</span>(<span class="title">object</span>) {</span>
    <span class="constant">return</span> <span class="string">'value'</span> <span class="operator">in</span> privates(object)
  },
  configurable: <span class="constant">true</span>,
  enumerable: <span class="constant">false</span>,
  writable: <span class="constant">true</span>
},
<span class="built_in">get</span>: {
  <span class="built_in">value</span>: <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="title">key</span>, <span class="title">fallback</span>) {</span>
    <span class="constant">return</span> privates(guard(key)).<span class="built_in">value</span> || fallback
  },
  configurable: <span class="constant">true</span>,
  enumerable: <span class="constant">false</span>,
  writable: <span class="constant">true</span>
},
<span class="built_in">set</span>: {
  <span class="built_in">value</span>: <span class="function"><span class="keyword">function</span> <span class="title">set</span>(<span class="title">key</span>, <span class="title">value</span>) {</span>
    privates(guard(key)).<span class="built_in">value</span> = <span class="built_in">value</span>
  },
  configurable: <span class="constant">true</span>,
  enumerable: <span class="constant">false</span>,
  writable: <span class="constant">true</span>
},
<span class="string">'delete'</span>: {
  <span class="built_in">value</span>: <span class="function"><span class="keyword">function</span> <span class="title">set</span>(<span class="title">key</span>) {</span>
    <span class="constant">return</span> <span class="built_in">delete</span> privates(guard(key)).<span class="built_in">value</span>
  },
  configurable: <span class="constant">true</span>,
  enumerable: <span class="constant">false</span>,
  writable: <span class="constant">true</span>
}
</code></pre><p>  }))<br>}<code>&lt;/pre&gt;
使用了</code>Object.create<code>创建了一个继承自WeakMap的新对象，并设置了has,get,set,delete方法。（其实我不太理解delete是个关键字，为什么标准要把它作为WeakMap的方法名之一？）然后使用</code>Object.freeze<code>确保对象无法被改变。避免有人通过</code>map.a = ‘string’`这样或其他方式去修改对象。</p>
<p>其中的关键点在于<code>var privates = Name()</code>一句。privates方法是用来“依据键获取键值”。</p>
<p>因为不能保存键的强引用所以需要将键值保存在键上。即WeakMap仅仅是提供了一个“键”与“值”之间的接口，通过WeakMap来设置或获取键对应值。这么一来就容易理解了，具体源代码如下：<br><pre><code>function defineNamespace(object, namespace) {
  /**
  Utility function takes</code>object<code>and</code>namespace<code>and overrides</code>valueOf<code>method of</code>object<code>, so that when called with a</code>namespace<code>argument,</code>private<code>object associated with this</code>namespace<code>is returned. If argument
  is different,</code>valueOf<code>falls back to original</code>valueOf` property.<br>  **/</pre></p>
<p>  // Private inherits from <code>object</code>, so that <code>this.foo</code> will refer to the<br>  // <code>object.foo</code>. Also, original <code>valueOf</code> is saved in order to be able to<br>  // delegate to it when necessary.<br>  var privates = Object.create(object), base = object.valueOf<br>  Object.defineProperty(object, ‘valueOf’, { value: function valueOf(value) {</p>
<pre><code>// <span class="keyword">If</span> <span class="escape">`t</span>his<span class="escape">` </span><span class="literal">or</span> <span class="escape">`n</span>amespace<span class="escape">` </span>is <span class="literal">not</span> associated with <span class="literal">a</span> <span class="escape">`p</span>rivates<span class="escape">` </span>being
// stored we fallback to original <span class="escape">`v</span>alueOf<span class="escape">`,</span> otherwise we <span class="keyword">return</span> privates.
<span class="keyword">return</span> value != namespace || this != object ? base.apply(this, arguments)
<span class="label">                                          :</span> privates
</code></pre><p>  }, configurable: true })<br>  return privates<br>}</p>
<p>function Name() {<br>  /<strong><br>  Desugared implementation of private names proposal. API is different as<br>  it’s not possible to implement API proposed for harmony with in ES5. In<br>  terms of provided functionality it supposed to be same.<br>  <a href="http://wiki.ecmascript.org/doku.php?id=strawman:private_names" target="_blank" rel="external">http://wiki.ecmascript.org/doku.php?id=strawman:private_names</a>
  </strong>/</p>
<p>  var namespace = {}<br>  return function name(object) {</p>
<pre><code>var privates = <span class="built_in">object</span>.valueOf(<span class="keyword">namespace</span>)
<span class="keyword">return</span> privates !== <span class="built_in">object</span> ? privates : defineNamespace(<span class="built_in">object</span>, <span class="keyword">namespace</span>)
</code></pre><p>  }<br>}</p>
<p>function guard(key) {<br>  /<strong><br>  Utility function to guard WeakMap methods from keys that are not<br>  a non-null objects.
  </strong>/</p>
<p>  if (key !== Object(key)) throw TypeError(“value is not a non-null object”)<br>  return key<br>}<code>&lt;/pre&gt;
代码中guard方法用于验证键是否是非空对象，又通过重写valueOf方法来获取键对应的存储值的对象。即是如下的引用关系：
&lt;pre&gt;</code>key -&gt; valueOf —(namespace)—&gt; privates —&gt; value</p>
</li>
</ol>
<p>其中的关键点是namespace是一个空对象。为什么呢？因为一个空对象是无法模仿的、是唯一的，如果改用字符串则很容易被知道字符串值的人直接通过<code>key.valueOf(&#39;namespace&#39;)</code>方法获取到privates。</p>
<p>所以实现WeakMap的核心是“如何构造一个<a href="http://wiki.ecmascript.org/doku.php?id=strawman:private_names" target="_blank" rel="external">唯一的无法伪造的属性名</a>”。</p>
<p>Nicolas还在Gozala方案的评论中提到了另外一种实现，具体见<a href="http://code.google.com/p/es-lab/source/browse/trunk/src/ses/WeakMap.js" target="_blank" rel="external">http://code.google.com/p/es-lab/source/browse/trunk/src/ses/WeakMap.js</a>。我还没有仔细看～</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://nodejs.in/2013/10/29/ecmascript-6e4b98bweakmap/" data-id="816lkclxrc90qx9m" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ECMAScript-6/">ECMAScript 6</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/html5/">html5</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/javascript/">javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/weakmap/">weakmap</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-e68a9be5bc83syntaxhighlighter-evolvede68f92e4bbb6" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2013/10/29/e68a9be5bc83syntaxhighlighter-evolvede68f92e4bbb6/" class="article-date">
  <time datetime="2013-10-29T04:58:31.000Z" itemprop="datePublished">Oct 29 2013</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Other/">Other</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2013/10/29/e68a9be5bc83syntaxhighlighter-evolvede68f92e4bbb6/">抛弃SyntaxHighlighter Evolved插件</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>代码高亮可能是wordpress里面最麻烦的一件事件了，以前一直用的插件叫做：<a href="http://www.viper007bond.com/wordpress-plugins/syntaxhighlighter/" target="_blank" rel="external">SyntaxHighlighter Evolved</a>。但是说实话，这个插件不太好用…编辑器在可视化和文本之间切换容易造成bug（代码无故加上&lt;pre&gt;之类的文字）。最悲剧地是：由于SyntaxHighlighter Evolved的语法很特殊，没办法替换成其他的高亮插件。语法如下（去掉空格）：</p>
<pre>[[js]]code[/ js]</pre>
不过这不是我替换掉它的主要原因。致命的缺陷是它使用的高亮js库是：[SyntaxHighlighter](http://alexgorbatchev.com/SyntaxHighlighter/)。这个库已经有些年头了，它生成的html是table而不是pre标签。table很难用CSS来优化，且不符合语义化。

于是fork修改了[SyntaxHighlighter Evolved的代码](https://github.com/zmmbreeze/syntaxhighlighter)，去掉了SyntaxHighlighter相关的html输出。这样就可以保证旧的文章依旧输出正确的pre标签。然后在主题里面使用[google-code-prettify](http://code.google.com/p/google-code-prettify/)来高亮代码。google-code-prettify有个很重要的优势就是可以自动判断代码的类型，这样对任何pre标签做处理即可。代码如下：
<pre>(function() {
    var pres = document.getElementsByTagName('pre');
    for (var i=0,l=pres.length; i&lt;l; i++) {
        pres[i].className = 'prettyprint';
    }
    prettyPrint();
})();</pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://nodejs.in/2013/10/29/e68a9be5bc83syntaxhighlighter-evolvede68f92e4bbb6/" data-id="d04kj22p651cvvdk" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SyntaxHighlighter/">SyntaxHighlighter</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SyntaxHighlighter-Evolved/">SyntaxHighlighter Evolved</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/google-code-prettify/">google-code-prettify</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/plugin/">plugin</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/wordpress/">wordpress</a></li></ul>

    </footer>
  </div>
  
</article>


  
  
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">9</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Java/javascript/">javascript</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Java/javascript/Other/">Other</a><span class="category-list-count">1</span></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Other/">Other</a><span class="category-list-count">16</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/UI/">UI</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/design/">design</a><span class="category-list-count">6</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/design/UI/">UI</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/design/javascript/">javascript</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/javascript/">javascript</a><span class="category-list-count">52</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/javascript/Other/">Other</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/javascript/Other/UI/">UI</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/javascript/UI/">UI</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/未分类/">未分类</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/&gt;/">&gt;</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/&lt;/">&lt;</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/++/">++</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/16/">1.6</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/invalid/">:invalid</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/valid/">:valid</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/@PostConstruct/">@PostConstruct</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AOP/">AOP</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Closures/">Closures</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Constraint-Validation/">Constraint Validation</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DSL/">DSL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Delete/">Delete</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DoctorJS/">DoctorJS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ECMAScript-6/">ECMAScript 6</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/File/">File</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Geolocation/">Geolocation</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Get/">Get</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/H5F/">H5F</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hibernate/">Hibernate</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hql/">Hql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IE/">IE</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JSLint/">JSLint</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JSONP/">JSONP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Javascript/">Javascript</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Math/">Math</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mobile-Safari/">Mobile Safari</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NodeList/">NodeList</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OAuth/">OAuth</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OOP/">OOP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ObjectdefineProperty/">Object.defineProperty</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OneTask/">OneTask</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Other/">Other</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PPT/">PPT</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Package/">Package</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PrototypeJS/">PrototypeJS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SimpleSVGMap/">SimpleSVGMap</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Sinon/">Sinon</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SyntaxHighlighter/">SyntaxHighlighter</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SyntaxHighlighter-Evolved/">SyntaxHighlighter Evolved</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TheSimplest/">TheSimplest</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UI/">UI</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Webshims/">Webshims</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/and/">and</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ant/">ant</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/arguments/">arguments</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/attr/">attr</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/auto/">auto</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/blog/">blog</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/br/">br</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bug/">bug</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/canvas/">canvas</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/checkbox/">checkbox</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/class/">class</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/classloader/">classloader</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/click/">click</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cocos2d-javascript/">cocos2d-javascript</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/coding/">coding</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/contenteditable/">contenteditable</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/context/">context</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/">css</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css-target/">css target</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css3/">css3</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/db2/">db2</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/emphasis/">emphasis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/event/">event</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/false/">false</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/filter/">filter</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/firefox/">firefox</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/getElementByTagName/">getElementByTagName</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/google-code-prettify/">google-code-prettify</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/grayScale/">grayScale</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/html/">html</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/html5/">html5</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/html解析/">html解析</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ifElse/">ifElse</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/image/">image</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/inline/">inline</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/input/">input</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ios/">ios</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jQuery/">jQuery</a><span class="tag-list-count">9</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jQueryemphasis/">jQuery.emphasis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java-bean/">java bean</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascri/">javascri</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/">javascript</a><span class="tag-list-count">46</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jsoup/">jsoup</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/label/">label</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/margin/">margin</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/memorize/">memorize</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mocks/">mocks</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/module/">module</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/module-loader/">module loader</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/moon/">moon</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mozilla/">mozilla</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nudging/">nudging</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/overflow/">overflow</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/overflowchanged/">overflowchanged</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/plugin/">plugin</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pre/">pre</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/presentation/">presentation</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/prop/">prop</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/prototype/">prototype</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/querySelectorAll/">querySelectorAll</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/referer/">referer</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/safari/">safari</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scope/">scope</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/setMonth/">setMonth</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spies/">spies</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/spring/">spring</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/stubs/">stubs</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/style/">style</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sun/">sun</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/svg/">svg</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tdd/">tdd</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/test/">test</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/text/">text</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/text-emphasis/">text-emphasis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/text-size-adjust/">text-size-adjust</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/true/">true</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/type/">type</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/underflow/">underflow</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/watchjs/">watch.js</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/weakmap/">weakmap</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webStorage/">webStorage</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/white-space/">white-space</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windowname/">window.name</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/windows/">windows</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wordpress/">wordpress</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/上下文/">上下文</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/中文乱码/">中文乱码</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/中点/">中点</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/主题/">主题</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/二进制/">二进制</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/传参/">传参</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/作用域/">作用域</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/使用方法/">使用方法</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/函数式编程/">函数式编程</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分时处理/">分时处理</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/前端/">前端</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/前端组件/">前端组件</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/十进制/">十进制</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/十进制与二进制/">十进制与二进制</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/原型链/">原型链</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/原码/">原码</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/反码/">反码</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/叠加/">叠加</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/命令/">命令</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/响应式设计/">响应式设计</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/囚犯与灯泡/">囚犯与灯泡</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/圆规/">圆规</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/块框/">块框</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/塌陷/">塌陷</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/多线程/">多线程</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/多行匹配/">多行匹配</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/字体/">字体</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/安装步骤/">安装步骤</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/小数/">小数</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/居中/">居中</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/幻灯片/">幻灯片</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/循环依赖/">循环依赖</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/换行/">换行</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/换行符/">换行符</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/教程/">教程</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数学/">数学</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/整数/">整数</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/新浪微博/">新浪微博</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/替换元素/">替换元素</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/正则表达式/">正则表达式</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/测试框架/">测试框架</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/浮点数计算/">浮点数计算</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/灰阶化/">灰阶化</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/着重符/">着重符</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/移码/">移码</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/空白符/">空白符</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/等高布局/">等高布局</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/算法/">算法</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/类型推理/">类型推理</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/约束验证/">约束验证</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/线程模型/">线程模型</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/缓存/">缓存</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/缩放/">缩放</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/能力域/">能力域</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/行内元素/">行内元素</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/补码/">补码</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/观察者模式/">观察者模式</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/记住密码/">记住密码</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/跨域/">跨域</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/跨域请求/">跨域请求</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/转换/">转换</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/通知/">通知</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/重构/">重构</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/钢之炼金术师/">钢之炼金术师</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/闭包/">闭包</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/霓虹灯/">霓虹灯</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/非替换元素/">非替换元素</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/面向对象/">面向对象</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/面向方面/">面向方面</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/风格/">风格</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/高宽自动扩展/">高宽自动扩展</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/&gt;/" style="font-size: 10.00px;">&gt;</a><a href="/tags/&lt;/" style="font-size: 10.00px;">&lt;</a><a href="/tags/++/" style="font-size: 10.00px;">++</a><a href="/tags/16/" style="font-size: 10.00px;">1.6</a><a href="/tags/invalid/" style="font-size: 10.00px;">:invalid</a><a href="/tags/valid/" style="font-size: 10.00px;">:valid</a><a href="/tags/@PostConstruct/" style="font-size: 10.00px;">@PostConstruct</a><a href="/tags/AOP/" style="font-size: 13.33px;">AOP</a><a href="/tags/Android/" style="font-size: 10.00px;">Android</a><a href="/tags/Closures/" style="font-size: 10.00px;">Closures</a><a href="/tags/Constraint-Validation/" style="font-size: 10.00px;">Constraint Validation</a><a href="/tags/DSL/" style="font-size: 10.00px;">DSL</a><a href="/tags/Delete/" style="font-size: 10.00px;">Delete</a><a href="/tags/DoctorJS/" style="font-size: 10.00px;">DoctorJS</a><a href="/tags/ECMAScript-6/" style="font-size: 10.00px;">ECMAScript 6</a><a href="/tags/File/" style="font-size: 10.00px;">File</a><a href="/tags/Geolocation/" style="font-size: 10.00px;">Geolocation</a><a href="/tags/Get/" style="font-size: 10.00px;">Get</a><a href="/tags/H5F/" style="font-size: 10.00px;">H5F</a><a href="/tags/Hibernate/" style="font-size: 16.67px;">Hibernate</a><a href="/tags/Hql/" style="font-size: 10.00px;">Hql</a><a href="/tags/IE/" style="font-size: 10.00px;">IE</a><a href="/tags/JSLint/" style="font-size: 10.00px;">JSLint</a><a href="/tags/JSONP/" style="font-size: 10.00px;">JSONP</a><a href="/tags/Java/" style="font-size: 20.00px;">Java</a><a href="/tags/Javascript/" style="font-size: 10.00px;">Javascript</a><a href="/tags/Math/" style="font-size: 10.00px;">Math</a><a href="/tags/Mobile-Safari/" style="font-size: 10.00px;">Mobile Safari</a><a href="/tags/NodeList/" style="font-size: 10.00px;">NodeList</a><a href="/tags/OAuth/" style="font-size: 10.00px;">OAuth</a><a href="/tags/OOP/" style="font-size: 10.00px;">OOP</a><a href="/tags/ObjectdefineProperty/" style="font-size: 10.00px;">Object.defineProperty</a><a href="/tags/OneTask/" style="font-size: 10.00px;">OneTask</a><a href="/tags/Other/" style="font-size: 10.00px;">Other</a><a href="/tags/PPT/" style="font-size: 10.00px;">PPT</a><a href="/tags/Package/" style="font-size: 10.00px;">Package</a><a href="/tags/PrototypeJS/" style="font-size: 10.00px;">PrototypeJS</a><a href="/tags/SimpleSVGMap/" style="font-size: 10.00px;">SimpleSVGMap</a><a href="/tags/Sinon/" style="font-size: 10.00px;">Sinon</a><a href="/tags/SyntaxHighlighter/" style="font-size: 10.00px;">SyntaxHighlighter</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09">September 2014</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/03">March 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/02">February 2014</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/11">November 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/10">October 2013</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/08">August 2013</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/11">November 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/10">October 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/09">September 2012</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/08">August 2012</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/06">June 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/03">March 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/12">December 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/09">September 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/07">July 2011</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/06">June 2011</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/05">May 2011</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/04">April 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/03">March 2011</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/02">February 2011</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/01">January 2011</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/12">December 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/11">November 2010</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/10">October 2010</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/09">September 2010</a><span class="archive-list-count">18</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/08">August 2010</a><span class="archive-list-count">28</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/06">June 2010</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2014/09/02/Atom-Shell入门/">Atom Shell入门</a>
          </li>
        
          <li>
            <a href="/2014/09/01/让你的站点支持触屏/">让你的站点支持触屏</a>
          </li>
        
          <li>
            <a href="/2014/09/01/[译]学习CSS布局/">[译]学习CSS布局</a>
          </li>
        
          <li>
            <a href="/2014/09/01/中文排版二三事/">中文排版二三事</a>
          </li>
        
          <li>
            <a href="/2014/09/01/hello-world/">CSS Counters</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2014 mzhou / zmmbreeze<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">

  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>



<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>